{
	auto_https off

	servers {
		timeouts {
			read_header 10s
			read_body 30s
			write 30s
			idle 2m
		}
	}
}

:80 {
	# Healthcheck must always return 200 (for LB)
	handle_path /healthcheck {
		respond "OK" 200
	}

	@auth host auth.libtomsoftware.com auth.localhost
	handle @auth {
		reverse_proxy lbt-auth-api:3000
	}

	@gateway host gateway.libtomsoftware.com gateway.localhost
	handle @gateway {
		reverse_proxy lbt-gateway:4000
	}

	@cia-api host cia-api.libtomsoftware.com cia-api.lbt-contractor-invoice.localhost
	handle @cia-api {
		reverse_proxy lbt-contractor-invoice-api:6000
	}

	# Explicit default rather than silent fallthrough
	handle {
		respond 404
	}
}

